<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>Starting Backbone JS</title>
	<script type="text/javascript" src="/js/jquery.js"></script>
	<script type="text/javascript" src="/js/underscore.js"></script>
	<script type="text/javascript" src="/js/backbone.js"></script>
	<script type="text/javascript">
	$(function () {
		// Model
		var Notes = Backbone.Model.extend({
			url: '/api/notes',
			defaults: {
				title: '',
				body: ''
			}
		});

		// View
		var NotesView = Backbone.View.extend({
			template: _.template('<form>\
				<legend>Share your thoughts</legend>\
				<div class="control-group">\
					<label for="title">Title:<label>\
					<input type="text" id="title" />\
				</div>\
				<div class="control-group">\
					<textarea rows="5" cols="40" id="body"></textarea>\
				</div>\
				<button id="submit" class="btn">submit</button>\
				<button id="remove" class="btn">remove</button>\
			</form>'),
			render: function() {
				this.$el.html(this.template());

				return this;
			},
			events: {
				'click #submit': 'submitForm',
				'click #remove': 'remove'
			},
			submitForm: function(e) {
				e.preventDefault();

				var callback = {
					success: function(res) {
						console.log(arguments);
						console.log(res);
					},
					error: function() {
						console.log(arguments);
						console.log('Error occurred');
					}
				};

				this.model.save({
					title: $('#title').val(),
					body: $('#body').val()
				}, callback);
			},
			remove: function(e) {
				e.preventDefault();

				this.model.destroy({
					title: $('#title').val(),
					body: $('#body').val()
				}, function(model, response) {
					console.log(model);
					console.log(response);
				});
			},
			destroy: function() {
		        Backbone.Model.prototype.destroy.call(this, {
		          headers: {'If-Match': this.get("_rev")}
		        });
		    }
		});

		// There is not controller, but application
		// Entry point or App
		var model = new Notes();
		var view = new NotesView({model: model});

		$('#notes').html(view.render().el);
	});
	</script>
</head>
<body>
	<!-- http://www.beletsky.net/2012/10/baby-steps-to-backbonejs-starting-up.html -->
	<div id="notes" class="container"></div>
	
	<script type="text/template" id="form">
		<form>
			<legend>Share the feedback</legend>
			<div class="control-group">
				<label for="email">Email:</label>
				<input type="text" id="email" placeholder="Your email address..." />
			</div>
			<div class="control-group">
				<label for="website">Web site:</label>
				<input type="text" id="website" placeholder="You website..." />
			</div>
			<div class="control-group">
				<label for="feedback">Feedback:</label>
				<textarea name="" id="feedback" rows="6" class="input-xxlarge" placeholder="feedback here..."></textarea>
			</div>
			<button id="submit" class="btn">Submit</button>
		</form>
	</script>
</body>
</html>